{% extends "base.html" %}

{% block title %}√éncarcƒÉ con»õinut{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3>√éncarcƒÉ con»õinut nou</h3>
            </div>
            <div class="card-body">
                <!-- Informa»õii despre tipurile suportate -->
                <div class="alert alert-info mb-4">
                    <h5>Ce po»õi √ÆncƒÉrca:</h5>
                    <ul class="mb-0">
                        <li><strong>Fi»ôiere:</strong> txt, pdf, doc, mp4, mov, mp3, wav</li>
                        <li><strong>Link-uri web:</strong> articole, bloguri, pagini de »ôtiri</li>
                    </ul>
                </div>

                <form method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="title" class="form-label">Titlu</label>
                        <input type="text" class="form-control" id="title" name="title" 
                               value="{{ request.args.get('title', '') }}" required 
                               placeholder="DƒÉ un titlu con»õinutului">
                        <div class="form-text">
                            Pentru URL-uri, titlul poate fi extras automat dacƒÉ nu √Æl completezi.
                        </div>
                    </div>

                    <!-- Tab-uri pentru a alege √Æntre fi»ôier »ôi URL -->
                    <div class="mb-3">
                        <h5>Alege sursa con»õinutului:</h5>
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="source_type" id="source_file" value="file" checked>
                            <label class="btn btn-outline-primary" for="source_file">√éncarcƒÉ fi»ôier</label>
                            
                            <input type="radio" class="btn-check" name="source_type" id="source_url" value="url">
                            <label class="btn btn-outline-primary" for="source_url">Link web</label>
                        </div>
                    </div>

                    <!-- Sec»õiunea pentru fi»ôiere -->
                    <div id="file-section" class="mb-3">
                        <label for="file" class="form-label">SelecteazƒÉ fi»ôier</label>
                        <input type="file" class="form-control" id="file" name="file">
                        <div class="form-text text-muted">
                            <strong>AcceptƒÉm:</strong><br>
                            üìÑ Text: txt, pdf, doc, docx<br>
                            üé• Video: mp4, mov, avi<br>
                            üéµ Audio: mp3, wav, ogg
                        </div>
                    </div>

                    <!-- Sec»õiunea pentru URL-uri -->
                    <div id="url-section" class="mb-3" style="display: none;">
                        <label for="url" class="form-label">Link cƒÉtre con»õinut</label>
                        <input type="url" class="form-control" id="url" name="url" 
                               value="{{ request.args.get('url', '') }}"
                               placeholder="https://example.com/articol">
                        <div class="form-text text-muted">
                            <strong>Func»õioneazƒÉ bine cu:</strong><br>
                            üì∞ Articole de »ôtiri<br>
                            üìù PostƒÉri de blog<br>
                            üìñ Pagini Wikipedia<br>
                            üìÑ Documenta»õii online
                        </div>
                        
                        <!-- Buton pentru testarea URL-ului -->
                        <div class="mt-2">
                            <a href="/test-url-extraction" class="btn btn-sm btn-outline-info" target="_blank">
                                üîç TesteazƒÉ mai √Ænt√¢i URL-ul
                            </a>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="content_type" class="form-label">Tipul con»õinutului</label>
                        <select class="form-select" id="content_type" name="content_type">
                            <option value="text">Text (articole, documente)</option>
                            <option value="video">Video</option>
                            <option value="audio">Audio</option>
                        </select>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">√éncarcƒÉ con»õinutul</button>
                        <a href="/" class="btn btn-outline-secondary">AnuleazƒÉ</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // LogicƒÉ pentru a schimba √Æntre fi»ôier »ôi URL
    document.querySelectorAll('input[name="source_type"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const fileSection = document.getElementById('file-section');
            const urlSection = document.getElementById('url-section');
            const fileInput = document.getElementById('file');
            const urlInput = document.getElementById('url');
            
            if (this.value === 'file') {
                fileSection.style.display = 'block';
                urlSection.style.display = 'none';
                urlInput.value = '';
                urlInput.removeAttribute('required');
                fileInput.setAttribute('required', '');
            } else {
                fileSection.style.display = 'none';
                urlSection.style.display = 'block';
                fileInput.value = '';
                fileInput.removeAttribute('required');
                urlInput.setAttribute('required', '');
            }
        });
    });
    
    // Ini»õializez corect dacƒÉ vine cu URL din query params
    {% if request.args.get('url') %}
        document.getElementById('source_url').checked = true;
        document.getElementById('source_url').dispatchEvent(new Event('change'));
    {% endif %}
    
    // Actualizare automatƒÉ tip con»õinut bazat pe extensia fi»ôierului
    document.getElementById('file').addEventListener('change', function() {
        const fileName = this.value.toLowerCase();
        const contentTypeSelect = document.getElementById('content_type');
        
        if (fileName.includes('.mp4') || fileName.includes('.mov') || fileName.includes('.avi')) {
            contentTypeSelect.value = 'video';
        } else if (fileName.includes('.mp3') || fileName.includes('.wav') || fileName.includes('.ogg')) {
            contentTypeSelect.value = 'audio';
        } else {
            contentTypeSelect.value = 'text';
        }
    });
</script>
{% endblock %}