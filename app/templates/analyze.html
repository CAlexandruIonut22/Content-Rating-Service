{% extends "base.html" %}

{% block title %}AnalizƒÉ AI - {{ content.title }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h3>AnalizƒÉ automatƒÉ AI: {{ content.title }}</h3>
            </div>
            <div class="card-body">
                <!-- Un mic avertisment despre modelul folosit -->
                <div class="alert alert-info">
                    <p><strong>NotƒÉ:</strong> Analiza este realizatƒÉ cu modelul TinyLlama (1.1B parametri) + Tavily Web Search. Rezultatele sunt orientative »ôi pot necesita o verificare suplimentarƒÉ.</p>
                </div>
                
                <!-- Info despre ce con»õinut analizƒÉm -->
                <div class="mb-4 border-bottom pb-3">
                    <h5>Con»õinut analizat:</h5>
                    {% if content.is_file %}
                        <p>
                            <strong>Fi»ôier:</strong> 
                            {% if content.file_path %}
                                {{ content.file_path.split('/')[-1] }}
                            {% else %}
                                (lipsƒÉ informa»õii)
                            {% endif %}
                        </p>
                    {% else %}
                        <p>
                            <strong>Link:</strong> 
                            <a href="{{ content.url }}" target="_blank">{{ content.url }}</a>
                        </p>
                    {% endif %}
                    <p class="text-muted">Tip: {{ content.content_type }}</p>
                </div>

                {% if analysis %}
                    <!-- Aici afi»ôƒÉm rezultatele analizei -->
                    <div class="mb-4">
                        <h5>Scor de factualitate:</h5>
                        <div class="progress mb-3" style="height: 25px;">
                            <div class="progress-bar {{ 'bg-danger' if analysis.factuality_score < 4 else ('bg-warning' if analysis.factuality_score < 7 else 'bg-success') }}" 
                                 role="progressbar" 
                                 style="width: {{ analysis.factuality_score * 10 }}%"
                                 aria-valuenow="{{ analysis.factuality_score }}" 
                                 aria-valuemin="0" 
                                 aria-valuemax="10">
                                {{ analysis.factuality_score }}/10
                            </div>
                        </div>
                        <p class="small text-muted">Nivelul de √Æncredere al modelului: {{ analysis.confidence }}/10</p>
                        {% if analysis.analysis_type %}
                            <p class="small text-muted">Tip analizƒÉ: {{ analysis.analysis_type }}</p>
                        {% endif %}
                        {% if analysis.web_search_performed %}
                            <p class="small text-success">üîç AnalizƒÉ hibridƒÉ cu web search efectuatƒÉ</p>
                        {% endif %}
                    </div>

                    <div class="mb-4">
                        <h5>De ce a primit acest scor:</h5>
                        <div class="card bg-light">
                            <div class="card-body">
                                <!-- SEC»öIUNEA FIXATƒÇ PENTRU AFI»òARE COMPLETƒÇ A REASONING-ULUI -->
                                <div style="white-space: pre-wrap; word-wrap: break-word; line-height: 1.6; font-family: inherit;">
                                    {{ analysis.reasoning }}
                                </div>
                            </div>
                        </div>
                    </div>

                    {% if analysis.questionable_claims and analysis.questionable_claims|length > 0 %}
                        <div class="mb-4">
                            <h5>Afirma»õii care ar trebui verificate:</h5>
                            <ul class="list-group">
                                {% for claim in analysis.questionable_claims %}
                                    <li class="list-group-item list-group-item-warning">{{ claim }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% else %}
                        <div class="alert alert-light">
                            <p>Modelul nu a identificat afirma»õii problematice specifice √Æn text.</p>
                        </div>
                    {% endif %}

                    <!-- Afi»ôeazƒÉ rezultatele web search dacƒÉ sunt disponibile -->
                    {% if analysis.verified_claims and analysis.verified_claims|length > 0 %}
                        <div class="mb-4">
                            <h5>üîç VerificƒÉri Web Search ({{ analysis.verified_claims|length }} afirma»õii):</h5>
                            <div class="row">
                                {% for claim in analysis.verified_claims %}
                                    <div class="col-md-12 mb-2">
                                        <div class="card border-{{ 'success' if claim.verification_status == 'adevarata' else ('danger' if claim.verification_status == 'falsa' else 'warning') }}">
                                            <div class="card-body py-2">
                                                <h6 class="card-title mb-1">
                                                    {% if claim.verification_status == 'adevarata' %}
                                                        ‚úÖ Confirmat prin web search
                                                    {% elif claim.verification_status == 'falsa' %}
                                                        ‚ùå Infirmat prin web search
                                                    {% else %}
                                                        ü§î Neconcludent
                                                    {% endif %}
                                                </h6>
                                                <p class="card-text small mb-1">{{ claim.claim }}</p>
                                                <p class="card-text small text-muted">{{ claim.explanation }}</p>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                            {% if analysis.sources_consulted %}
                                <p class="text-muted small">Surse consultate: {{ analysis.sources_consulted }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                {% else %}
                    <div class="alert alert-warning">
                        <p>Ups! Nu am putut realiza analiza automatƒÉ pentru acest con»õinut.</p>
                        <p>Posibile cauze:</p>
                        <ul>
                            <li>Textul este √Æntr-un format nesuportat</li>
                            <li>Con»õinutul este prea lung pentru model</li>
                            <li>A apƒÉrut o eroare tehnicƒÉ √Æn timpul analizei</li>
                        </ul>
                        <p>Po»õi √Æncerca sƒÉ evaluezi manual acest con»õinut folosind butonul de mai jos.</p>
                    </div>
                {% endif %}

                <div class="mb-3 border-top pt-3 mt-4">
                    <h5>Ce √ÆnseamnƒÉ aceste scoruri?</h5>
                    <ul>
                        <li><strong>1-3:</strong> Con»õinut problematic - probabil con»õine informa»õii false sau √Æn»ôelƒÉtoare</li>
                        <li><strong>4-6:</strong> Con»õinut mixt - unele informa»õii par corecte, altele ar putea fi discutabile</li>
                        <li><strong>7-10:</strong> Con»õinut de calitate - pare sƒÉ con»õinƒÉ informa»õii solide »ôi bine documentate</li>
                    </ul>
                    <div class="alert alert-secondary mt-2">
                        <small>»öine minte: AceastƒÉ analizƒÉ e realizatƒÉ de TinyLlama (1.1B parametri) cu web search. Rezultatele sunt orientative »ôi nu √Ænlocuiesc judecata umanƒÉ. Cel mai bine este sƒÉ verifici din surse multiple!</small>
                    </div>
                </div>

                <!-- Butonul de ac»õiune -->
                <div class="d-grid gap-2">
                    <a href="{{ url_for('view_content', content_id=content.id) }}" class="btn btn-primary">
                        <i class="bi bi-arrow-left"></i> √énapoi la con»õinut
                    </a>
                    {% if session.get('user_id') %}
                        <a href="{{ url_for('rate_content', content_id=content.id) }}" class="btn btn-success">
                            <i class="bi bi-star-fill"></i> Vreau sƒÉ evaluez eu acest con»õinut
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}